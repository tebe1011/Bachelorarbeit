%% content.tex
%%

%% ===========================
\chapter{Systemanalyse}
\label{ch:Systemanalyse}
%% ===========================

Zu Beginn der Arbeiten wird eine Systemanalyse zur Ermittlung des Ist- und Sollzustandes durchgeführt. Nach \cite{SWB-380277719} versteht man darunter das Beschreiben der vorhandenen und zukünftigen Systeme. Zuerst wird in Abschnitt \ref{ch:Systemanalyse:sec:genesisWorld} eine Ist-Analyse durchgeführt. In Abschnitt \ref{ch:Systemanalyse:sec:Anforderungsanalyse} wird auf die, an das System gestellt, Anforderungen eingegangen. Aufbauend auf den Anforderungen werden in Abschnitt \ref{ch:Systemanalyse:sec:Information} die relevanten Daten für die Umsetzung ermittelt. 

%% ===========================
\section{CAS genesisWorld}
\label{ch:Systemanalyse:sec:genesisWorld}
%% ===========================

CAS genesisWorld ist eine Software, die Organisation und Zusammenarbeit in Kundenbeziehungen und zwischen Kollegen steigern soll. Alle Informationen bzw. Daten werden in CAS genesisWorld zentral gespeichert und sind so für alle verfügbar. Welche Daten ein Anwender sieht, hängt von seinen Rechten und Einstellungen ab. Die Daten, d.h. Termine, Aufgaben, Adressen, Dokumente usw. werden in CAS genesisWorld von den Nutzern gepflegt und aktuell gehalten. Darüber hinaus lassen sich wie in Abbildung \ref{picGwCon} dargestellt, alle Daten beliebig miteinander verknüpfen. So werden zusätzliche Zusammenhänge deutlich und der Informationsgehalt steigt. Ein Besprechungstermin lässt sich beispielsweise mit den Adressen der Teilnehmer und dem Dokument der Tagesordnung verknüpfen.

\begin{figure}[H]
	\centering
  \includegraphics[width=0.5\textwidth, width=0.5\textwidth]{pics/CAS_connections.pdf}
	\caption{Verknüpfungen in CAS genesisWorld}
	\label{picGwCon}
\end{figure}

%% ===========================
\subsection{Architektur}
%% ===========================

Die N-Tier-Architektur von CAS genesisWorld lässt sich in drei wesentliche Bereiche gliedern:

\begin{itemize}

	\item Die Präsentationsclients umfassen alle Dienste, die Informationen in Bildschirmansichten den Benutzern zur Verfügung stellen.
	
	\item Der Applikationsserver umfasst alle Dienste, um die Geschäftslogik zu kapseln, Änderungen zu protokollieren, Benutzerrechte zu prüfen und die aufbereiteten Informationen den Präsentationsdiensten zur Verfügung zu stellen.
	
	\item Die Datenbankschicht umfasst alle Dienste die zur Datenhaltung selbst notwendig sind.
\end{itemize}


%% ===========================
\subsection{Präsentationsschicht \& Logikschicht}
%% ===========================

Der CAS genesisWorld Client existiert in Form einer Windowsanwendung, als mobile Version in Android, Windows Phone, BlackBerry OS und iOS. Die Kommunikation der Clients mit CAS genesisWorld findet über das REST-Protokoll statt \cite{cas2013a}.

Die Funktionalität des CAS genesisWorld Anwendungsservers wurde in Form von COM-Objekten implementiert. Damit stehen dessen Dienste auch Dritten zur Verfügung, die dadurch mit eigenen Applikationen die Informationen von CAS genesisWorld präsentieren oder weiterverarbeiten können. Eine erster Überblick der CAS genesisWorld Komponenten ist in Abbildung \ref{gw_Architektur} zu sehen. Als Basisdienste stehen der UserService und der DataService zu Verfügung. Für die Anmeldung und Rechteverwaltung ist der UserService zuständig. Der DataService ist als zentraler Dienst für den Zugriff auf die CAS genesisWorld Daten verantwortlich. Die Schnittstelle des DataService wurde an Microsoft ADO angelehnt. Auf den Basisdiensten aufbauend existieren die Geschäftsdienste, in Form der Schnittstellen der BusinessServices. Diese bieten spezielle Funktionen zu den jeweiligen Anwendungsbereichen.

\begin{figure}[H]
	\centering
  \includegraphics[width=0.6\textwidth, width=0.6\textwidth]{pics/GenesisWorld_Architektur.pdf}
	\caption{Schematische Darstellung der Architektur von CAS genesisWorld}
	\label{gw_Architektur}
\end{figure}

%% ===========================
\subsection{Datenhaltungsschicht}
\label{ch:Systemanalyse:sec:genesisWorld:subsec:db}
%% ===========================

Die Datenhaltungsschicht enthält einen Microsoft SQL Server 2008 (MSSQL). Der SQL Server ist ein relationales Datenbankmanagementsystem (RDBMS) von Microsoft, dass für den Einsatz im Konzernumfeld konzipiert wurde. MSSQL verwendet T-SQL (Transact-SQL), eine Erweiterungen von Sybase und Microsoft, die den SQL-Standard um prozedurale Sprachelemente erweitert \cite{tech2013}. Weiterhin unterstützt MSSQL standardisierte Datenbankschnittstellen, wie Open Database Connectivity (ODBC) und Java Database Connectivity (JDBC).

Beim Schema der Datenbank wird auf eine Besonderheit eingegangen. In relationalen Datenbanken werden Beziehungen über Primär- und Fremdschlüssel abgebildet. Dies ist auch in der MSSQL-Datenbank der Fall, jedoch mit einer Besonderheit. In der MSSQL-Datenbank werden nur Primärschlüssel deklariert. Es werden Fremdschlüssel verwendet allerdings sind sie nicht als solche deklariert.

Ein Grund dafür ist die Art wie die Funktionalität zur Verknüpfung sämtlicher Datensätze in der Datenbank umgesetzt wurde. Abbildung \ref{gw_2} zeigt das ER-Modell zu dieser Funktionalität. Bei 198 Tabellen würde die Funktionalität durch die M:N-Beziehung zu 39.006 Auflösungstabellen führen. Um das zu vermeiden wird lediglich eine Tabelle verwendet. Sie besitzt vier relevante Spalten. In zwei von ihnen werden die Fremdschlüssel der in Beziehung zu setzenden Tabellen aufbewahrt. Damit die nächst höhere Schicht die Fremdschlüssel den entsprechenden Tabellen zuordnen kann werden in den anderen beiden Spalten die Zuordnungskürzel hinterlegt. Jede Tabelle besitzt sein eigenes eindeutiges Kürzel. Die Nutzung einer Auflösungstabelle ist nur möglich weil die beiden Spalten in denen die Fremdschlüssel aufbewahrt werden nicht als solche deklariert sind.

Weiterführende Erläuterungen zum relevanten Teil des Schemas werden in Abschnitt \ref{ch:Systemanalyse:sec:Information} behandelt.

\begin{figure}[ht]
	\centering
  \includegraphics[width=0.9\textwidth, width=0.9\textwidth]{pics/erm.pdf}
	\caption{ER-Modell}
	\label{gw_2}
\end{figure}

Die Spalten \textit{GUID1} und \textit{GUID2} beinhalten die jeweiligen Primärschlüssel der in Beziehung zu setzenden Tabellen. Mithilfe der Spalten \textit{TableSign1} und \textit{TableSign2} können die \textit{GGUID}s den Tabellen, aus denen sie entstammen, zugeordnet werden. Die \textit{GGUID} ist in der gesamten Datenbank eindeutig und dient als Primärschlüssel für jede Tupel in der Datenbank.

%% ===========================
\subsection{Server-SDK-Plugin}
\label{ch:Systemanalyse:sec:genesisWorld:subsec:plugin}
%% ===========================

Die Server-SDK-Plugins bieten die Möglichkeit die Datenverarbeitung, um eine eigene Logik zu erweitern oder zu modifizieren. 

Realisiert werden die Plugins als COM-Objekte, die ein Plugin-Interface namens \textit{IGWSDKDataPlugIn} implementieren. Das erstellte COM-Objekt wird im Server von CASgenesisWorld registriert. Der Server delegiert bei einer Datenoperation den Aufruf an die für den jeweiligen Datensatztypen registrierten Plugins. In Abbildung \ref{gw_plugin} ist ein Beispiel des Vorgangs dargestellt. Die CASTable ist für die Delegation der Datenmanipulation-Anweisungen zuständig. Sie empfängt Anweisungen vom DataService und führt diese auf dem MSSQL-Server aus. Außerdem besitzt sie mit dem Plugin-Direktor eine Komponente mit der Plugins über Änderungen in den Datensätzen informiert werden. Wie in der Abbildung zu sehen werden zuerst die fest integrierten Plugins wie das CAS-Address-Plugin benachrichtigt. Anschließend werden die von Dritten erstellten Plugins informiert.

\begin{figure}[H]
	\centering
  \includegraphics[width=1.0\textwidth, width=1.0\textwidth]{pics/analyse_plugins.pdf}
	\caption{Beispiel zur Benachrichtigung von Plugins anhand eines Ablaufs bei einem Update}
	\label{gw_plugin}
\end{figure}

Im Allgemeinen stehen in den COM-Schnittstellen der Plugins, jeweils alle Felder eines Datensatztypen zur Verfügung, sowie die neuen Werte der Felder. In den Plugins besteht somit die Möglichkeit, alte bzw. neue Werte von Feldern zu untersuchen und zu vergleichen und auf das Ergebnis zu reagieren.

Die Werte des aktuell verarbeiteten Datensatzes können verändert, d.h. erweitert oder reduziert werden. Darüber hinausgehend sind auch automatisierte Aktionen realisierbar, die weitere Datensätze betreffen. So könnten z.B. abhängig von den Eingangswerten einer neu angelegten Adresse, neue Aufgaben angelegt und mit Inhalt versehen werden. Einige automatische Datenoperationen von CAS genesisWorld werden über CAS-Plugins realisiert, die mit den SDK-Plugins verwandt sind.

%% ===========================
\section{Anforderungsanalyse}
\label{ch:Systemanalyse:sec:Anforderungsanalyse}
%% ===========================

Während der Anforderungsanalyse wird ermittelt, welche Eigenschaften und Fähigkeiten das System zur Erreichung der Ziele benötigt. Bei der Einteilung der Anforderungen wird zwischen Funktionalen und Nichtfunktionalen unterschieden. Bei ersterem wird die Funktionalität des zu erstellenden Systems beschrieben, wohingegen die Randbedingungen und Qualitätsanforderungen unter letzteres Fallen. 

%% ===========================
\subsection{Funktionale Anforderungen}
%% ===========================

Der Kernfunktionalität ist die Bewertung von Beziehungen zwischen Personen aus einem CRM-System. Die Bewertung soll auf den sogenannten CRM-Objekten basieren. Jedes Objekt repräsentiert ein anderes Element des CRM-Systems. Die Adresse einer Person ist z.B. ein solches CRM-Objekt. Die Adresse allerdings ist ein Objekt welches nur einer Person zuzuordnen ist. In der Umsetzung der Funktionalität spielen Objekte die mehrere Personen betreffen eine Rolle. Um eine Beziehung bewerten zu können werden Objekte herangezogen die einen Austausch von Informationen unter Personen wiederspiegeln.
 
Das erste Objekt welches dem Kriterium gerecht wird ist der Termin. Indessen eine Zusammenkunft bestimmter Personen stattfindet. Das Dokument stellt das nächste Objekt dar. Dessen Eignung beruht auf der Möglichkeit anderen Personen Zugriffsrechte und somit Einsicht auf Dokumente zu gewähren. Zur Beachtung des Informationsaustauschs durch verbale sowie schriftliche Kommunikation werden die E-Mail und das Telefonat einbezogen. Das letzte Objekt ist die Verkaufschance. Sie repräsentiert eine Aussicht auf einen potentiellen Abschluss eines Geschäfts. Durch sie können Vertriebsmitarbeiter ihre Leads strukturiert und organisiert ablegen.

Der Wert einer Beziehung soll anhand der Anzahl von Objekten, in denen beide Personen vorkommen, ermittelt werden. Ein Beispiel für eine solche Anzahl von Objekten sind alle Termine an denen beide Personen teilgenommen haben. Summiert mit der Anzahl der anderen Objekte ergibt sich die Wertigkeit der Beziehung. 

Weiterhin soll der Benutzer die Bewertung aller Beziehungen zu einer Person ermitteln können. Die Beziehungen sind in einer absteigenden Reihenfolge nach ihrem Werte zu präsentiert. Das Ergebnis soll außerdem durch den Benutzer auf eine von ihm festgelegte Menge an Beziehungen eingrenzbar sein. Neben der Anzahl von Beziehungen soll auch der für die Bewertung betrachtete Zeitraum verändert werden können. Es soll auch möglich sein den Zeitraum unterschiedlich zu gewichten. Dazu sind zwei Zeitspannen festzulegen. Die eine beginnt am Anfang des Zeitraums und endet zu einem angegeben Zeitpunkt. Die andere beginnt zu einem angegeben Zeitpunkt und reicht bis zum Ende des Zeitraums. Beide Zeitpunkte sollen durch den Benutzer angegeben werden können. Nicht nur der Zeitraum sondern auch die CRM-Objekte sollen gewichtbar sein. Hierzu soll dem Benutzer die Möglichkeit offen stehen einzelne Objekte wie Dokumente differenziert zu gewichten. Überdies soll er entscheiden können welche Personen, Gruppen, Städte, Kontakte, Firmenkontakte, Mitarbeiter und Länder aus der Bewertung ausgeschlossen werden.

%% ===========================
\subsection{Nichtfunktionale Anforderungen}
%% ===========================

Folgende nichtfunktionale Anforderungen wurden erhoben:

\begin{itemize}
	
	\item Falls die Möglichkeit besteht nur eine Rechnerinstanz für den Datenbankserver und Applikationsserver verwenden.
	
	\item Das System soll sehr kurze Antwortzeiten (< 1s) in der Beantwortung von Benutzerabfragen aufweisen. 
	
	\item In der Implementierung soll versucht werden eine möglichst lose Kopplung zwischen der Anwendungslogik und den Komponenten der Darstellung zu erreichen.
	
	\item Das System soll eine hohe Portabilität aufweisen, damit es einfach auf anderen Rechnern in Betrieb genommen werden kann.
	
	\item Die Ergebnisse der Bewertung sind dem Nutzer graphisch aufzubereiten. 
	
	\item Der Einsatz von Open-Source-Produkten ist gegenüber den von kommerziellen Produkten vorzuziehen.

\end{itemize}

%% ===========================
\section{Ermittlung relevanter Daten}
\label{ch:Systemanalyse:sec:Information}
%% ===========================

In diesem Abschnitt werden die relevanten Datensätze aus der MSSQL-Datenbank erörtert. Dazu werden Tabellen die zum realisieren der funktionalen Anforderungen notwendig sind näher beschrieben.

Die Datenbank der CAS Software AG umfasst 398 Tabellen, die zusammen wiederum 11.620 Spalten beinhalten. Aufgrund einer fehlenden Dokumentation über die Umsetzung der Anwendungsschicht und Beziehungen nicht über Fremdschlüssel identifiziert werden können wurde ein eigenes Verfahren zur Ermittlung von Beziehungen entwickelt. 

Für den Ausgangspunkt der Suche wurde eine Tabelle namens \textit{SysUser} verwendet. Sie beinhaltet jeden Benutzer des Systems. Ihre Eignung beruht auf der Annahme, dass bei der Bewertung von Beziehungen zwischen Personen, die Person selbst den Ausgangspunkt der Suche darstellt. Daher wird zuerst eine Tupel der \textit{SysUser} Tabelle mit ihrer \textit{GGUID} herangezogen. Die \textit{GGUID} ist der erste Wert nachdem in der gesamten Datenbank gesucht wird. Sobald alle Tabellen gefunden wurden, die den Wert beinhalten, wird eine \textit{GGUID} aus jeder Tabelle für die weitere Suche verwendet. Die Anzahl der zu durchsuchenden Tabellen werden nach jedem Schritt um die bereits gefundenen Tabellen verringert. Die Suche wird abgebrochen, sobald die Suchmenge keine Werte mehr aufweist oder keine Tabellen mehr mit den entsprechenden Werten gefunden wurden. Durch dieses Vorgehen werden alle Beziehungen ermittelt, die durch Verwendung der \textit{GGUID} als Referenzwert identifiziert werden können. In Abbildung \ref{gw_schema_alt} ist ein auf das Wesentliche reduzierter Ausschnitt des Ergebnisses zu sehen. 

Von den ursprünglichen 398 Tabellen sind nur noch 17 übrig geblieben, auf die im weiteren Verlauf eingegangen wird. Alle Tabellen enthalten in der ursprünglichen Form wesentlich mehr Spalten und wurden der Übersicht halber entfernt. Tabelle \textit{SysUser} besitzt drei Spalten die von Bedeutung sind. Eine davon ist die \textit{GGUID}, die im Folgenden nicht weiter erwähnt wird, da sie jede Tabelle enthält. Die \textit{OID} wird für jeden Nutzer einmalig vergeben und wird in anderen Tabellen als Zuordnungsmerkmal verwendet. \textit{LoginName} ist der Benutzername des Nutzers und kann beim Anmelden auf der Oberfläche verwendet werden. 

Um Personen aus bestimmten Gruppen aus der Abfrage auszuschließen werden die Tabellen \textit{SysGroupMember} und \textit{SysGroup} benötigt. Die \textit{GID} der Tabelle \textit{SysGroup} wird als Referenzierungswert in anderen Tabellen verwendet, um auf Gruppen zu verweisen. Die Spalte wird später zur Zuordnung von Gruppen benötigt. Die Spalte \textit{GroupName} wird zum anzeigen der Gruppennamen an der Oberfläche benötigt.  \textit{SysGroupMember} stellt die Auflösungstabelle zwischen \textit{SysUser} und \textit{SysGroup} dar. Die Spalte \textit{GroupID} beinhaltet Werte aus der Spalte \textit{GGUID} der Tabelle \textit{SysGroup}. Bei der Spalte \textit{MemberID} verhält es sich genauso wie bei der Spalte \textit{GroupID}, allerdings enthält sie die \textit{GGUID} der Personen anstatt die \textit{GGUID} der Gruppen. Die Spalte \textit{InsertTimestamp} wird zur Überprüfung der Existent, zu einem bestimmten Zeitpunkt benötigt.

Die Tabelle \textit{Address0} wird zur Umsetzung der restlichen Filterungen benötigt. \textit{Town1} und \textit{Country1} geben die Stadt, sowie das Land an, in der die Person ansässig ist. Um festzustellen, ob eine Person eine Kontaktperson, Mitarbeiter oder ein Firmenkontakt ist werden die Attribute \textit{gwIsContact}, \textit{gwIsEmployee} und \textit{gwIsCompany} benötigt. \textit{ChristianName} und \textit{Name} beinhalten den Vor- und Nachname einer Person, welche für die Zuordnung der Ergebnisse an der Benutzeroberfläche hilfreich sind. Weiterhin lassen sich  nicht alle Telefongespräche über die dafür bestimmten Tabellen ermitteln. Die Spalten \textit{PhoneFieldStr1} bis \textit{PhoneFieldStr10} ermöglichen es die restlichen Zuordnungen vorzunehmen.

Die Tabelle \textit{TableRelation} enthält, wie in Abschnitt \ref{ch:Systemanalyse:sec:genesisWorld:subsec:db} behandelt, die Verknüpfungen zwischen den Tabellen der Verbindungsmerkmale. Beispielsweise könnten alle Termine einer Person mit ihrer \textit{GGUID} ermittelt werden. Durch dessen Verwendung als \textit{GUID1}, ließen sich alle Verbindungsmerkmale anhand ihrer \textit{GGUID}s in der Spalte \textit{GUID2} ermitteln. Zur Begrenzung der Ergebnisse auf Termine müsste lediglich noch der Kürzel von Terminen, aus der Spalte \textit{TableSign2}, als Bedingung in der Abfrage genutzt werden.

\begin{figure}[H]
	\centering
  \includegraphics[width=1.0\textwidth]{pics/schema_alt.pdf}
	\caption{Auszug aus dem Schema des MSSQL 2008}
	\label{gw_schema_alt}
\end{figure}

Alle Informationen zu den Verkaufschancen finden sich in der Tabelle \textit{GWOpportunity0}. Die Spalte \textit{InsertTimestamp} wird zum Ermitteln des Erzeugungszeitpunktes benötigt. \textit{start\_dt} und \textit{end\_dt} legen den Zeitraum der Verkaufschance fest. Der Besitzer einer Verkaufschance wird über die Spalte \textit{AccountGUID} bestimmt. Mit den Tabellen \textit{EMailStore0}, \textit{Document0} \textit{Appointment0} und \textit{gwPhoneCall0} verhält es sich wie mit der Tabelle \textit{GWOpportunity0}. Bei der Tabelle\textit{EMailStore0} wird allerdings die Spalte \textit{SendDate} zur zeitlichen Einordnung verwendet. Eine weitere Besonderheit ist in der Spalte \textit{DialledNumber} der Tabelle \textit{gwPhoneCall0} vorhanden. Sie wird zum Vergleich mit der in der Adresse hinterlegten Telefonnummer benötigt. Um festzustellen, ob das Telefonat über einen Tag hinausging wird die Spalte \textit{duration} herangezogen.

Beziehungen lassen sich nicht nur aus der \textit{TableRelation} entnehmen, sondern auch aus den Tabellen die auf \textit{ORel} enden. In ihnen werden  Beziehungen aufbewahrt die durch Teilen von Zugriffsrechten entstanden sind. Jede dieser Tabellen enthält eine \textit{OID} bzw. \textit{GID}, die zur Bestimmung der beteiligten Personen dienen.

Eine Betrachtung basierend auf Zeitspannen impliziert die Veränderung von Zuständen und Konstellationen über die Zeit hinweg. Um diese Änderungen zu erfassen wird die Tabelle \textit{ChangeLogBook} benötigt. Die Spalte \textit{NewFieldValue} enthält die neuen Werte von Tupeln, wohingegen die Spalte \textit{OldFieldValue} den alten Wert besitzt. Die durch die Aktualisierung betroffene Spalte ist in der Spalte \textit{FieldName} hinterlegt. Der Name der betroffenen Tabelle ist der Spalte \textit{TableName} zu entnehmen. Die Referenzierung auf eine Tupel wird in der Spalte \textit{TableGUID} vorgenommen. Aus Gründen des Speicherplatzverbrauchs werden nur varchar Datentypen bei Zeichenfolgen verwendet. Varchar ist allerdings auf 4000 Zeichen limitiert. Falls Zeichenfolgen diese Grenze überschreiten, werden diese in der Tabelle \textit{MemoLogBook} abgelegt. Dort wird der Datentyp Text verwendet, der eine maximale Zeichenfolgenlänge von $2^{31}-1$ (2.147.483.647) erlaubt.